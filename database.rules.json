{
  "rules": {
    "communities": {
      "$communityId": {
        "messages": {
          ".read": "auth != null",
          "$messageId": {
            ".write": "auth != null",
            ".validate": "(!data.exists() && newData.child('from').val() === auth.uid && newData.hasChildren(['from', 'fromName', 'content', 'timestamp', 'readBy'])) || (data.exists() && newData.child('from').val() === data.child('from').val() && newData.child('fromName').val() === data.child('fromName').val() && newData.child('content').val() === data.child('content').val() && newData.child('timestamp').val() === data.child('timestamp').val())"
          }
        }
      }
    }
  }
}
